<!DOCTYPE html>
<html><head><title>.</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8"/><meta name="author" content="Oros"><meta name="description" content="A fake javascript terminal. Source code on github https://github.com/Oros42/js_terminal"><style type="text/css">
/*
@font-face {
	font-family: 'monospace';
	font-style: normal;
	font-size: 16px;
	src: local('monospace'), url(./DejaVuSansMono.ttf) format('truetype');
}
*/
body{background-color:black;color:#00FF00;font-family:monospace;font-size:16px;}
.center{text-align:center;position:absolute;top:50%;width:100%;height:1px;}
.curs{display: inline;animation-duration:0.8s;animation-name:blink;animation-iteration-count:infinite;animation-timing-function:steps(2=3, start);}
@keyframes blink {49%{visibility:visible;background:none repeat scroll 0 0 #00FF00;color:#000000;}51% {visibility:hidden;background:none repeat scroll 0 0 #000000;color:#00FF00;}}
#c {display:inline;background:none repeat scroll 0 0 #00FF00;color:#000000;}#c2 {display:inline;}.i{display:inline;}.l{color:white;}
</style></head>
<body>
<div id="console" class="center">
	<noscript style="color:red">Error javascript not enable!</noscript><div id="a" class="i a"></div><div id="r" class="i r"><span id='c2' class="curs" style='display:none'>&nbsp;</span></div><span id='c' class="curs">&nbsp;</span>	
</div>
<script type="text/javascript">
var term_history=[];
var term_history_pos=0;
var files={};
files['README.txt']="\nThis is a funy javascript terminal.\nI make it juste for fun ^_^\n";

var man={};
man['cat']="\nCAT(1)                   User Commands                               CAT(1)\n\nNAME\n       cat - concatenate files and print on the standard output\n\nSYNOPSIS\n       cat [FILE]...\n\nDESCRIPTION\n       Concatenate FILE(s), or standard input, to standard output.\n\nEXAMPLES\n       cat README.txt\n              Output README.txt's contents to standard output.\n";

var programs={};
programs['help']=function(a){var c="\nAvailable commands :";for(var e in programs){c+="\n    "+e;} return c;};
programs['ls']=function(a){return "\nREADME.txt";};
programs['cat']=function(a){a=a.join('');if(a==''){return "\nPlease give me a file name !";}else if(files[a]!=undefined){return files[a];}else{return "\ncat: "+a+": No such file or directory";}};
programs['pwd']=function(a){return "\n/home/"+login;};
programs['man']=function(a){a=a.join('');if(man[a]!=undefined){return man[a];}else{return "\nNo manual entry for "+a;}};
programs['clear']=function(a){ clear_term(); return "\n";};
programs['exit']=function(a){document.body.innerHTML='Connection close';input_lock=true;return false;};

var input_lock=true;
var key_rep_state=0;
var step=0;
var login="";
var q1=[];
var q2=[];
var host="ecirtam";
var can_autocomp=false;

function write(t, b, f, s){if(t.length>0){input_lock=true;if(s!=undefined&&s>0){document.getElementById("c").className="";document.getElementsByClassName(b)[0].innerHTML+=htmlEntities(t.substring(0,1));window.setTimeout(function(){write(t.substring(1,t.length),b,f,s);},s);}else{document.getElementsByClassName(b)[0].innerHTML+=htmlEntities(t);window.scroll(0,window.screenMaxY);input_lock=false;if(f!=undefined){f();}}}else{document.getElementById("c").className="curs";window.scroll(0,window.screenMaxY);input_lock=false;if(f!=undefined){f();}}}

function newline(s){
	document.getElementsByClassName('a')[0].className='i';
	document.getElementById('c').remove();
	document.getElementById('c2').remove();
	var r=document.getElementsByClassName('r')[0];
	r.className='i';
	r.insertAdjacentHTML('afterEnd', '<div class="i a"></div><div class="i r">'+q1.join('')+'<span id="c2" class="curs" style="display:none">&nbsp;</span>'+q2.join('')+'</div><span id="c" class="curs">&nbsp;</span>');
	s+="\n"+login+"@"+host+":~$ ";
	write(s, 'a', curs_switch,0);
}

function htmlEntities(s) {
	return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/ /g, '&nbsp;').replace(/\n/g, '<br/>');
}

function h(){
	var o=q1.join('');
	o=htmlEntities(o);
	if(q2.length>0){
		o+='<span id="c2" class="curs">'+htmlEntities(q2[0])+'</span>';
		var o2='';
		for (var i=1,end=q2.length;i<end;i++){
			o2+=q2[i];
		};
		o+=htmlEntities(o2);
	}else{
		o+='<span id="c2" class="curs">&nbsp;</span>';
	}
	document.getElementsByClassName('r')[0].innerHTML=o;
}

function clear_term(){document.getElementById("console").innerHTML='<div id="a" class="i a"></div><div id="r" class="i r"><span id="c2" class="curs" style="display:none">&nbsp;</span></div><span id="c" class="curs">&nbsp;</span>';}

var curs_switch=function(){document.getElementById("c").style.display='none';document.getElementById("c2").style.display='';}

var enter=function (){
	switch(step){
		case 0:
			step+=1;
			document.getElementById("c").style.display='none';
			document.getElementById("c2").style.display='';
			break;
		case 1:
			step+=1;
			clear_term();
			document.getElementById("console").className='';
			login=q1.join('')+q2.join('');
			q1=[];
			q2=[];
			var s="Hello, "+login+"\n\n";
			write(s, 'a', enter, 50);
			break
		case 2:
			step+=1;
			document.getElementById("a").innerHTML+='<span class="l"></div>';
			s='   \\\\ '+"\n"
			+'  __()'+"\n"
			+'o(_-\\_'+"\n";
			write(s, 'l', enter, 50);
			break
		case 3:
			step+=1;
			write(login+"@"+host+":~$ ", 'a');
			q1="help".split('');
			can_autocomp=true;
			write("help", 'a', enter, 50);
			break
		case 4:
			step+=1;
			document.getElementById("c").style.display='none';
			document.getElementById("c2").style.display='';
		default:
			var output=q1.join('')+q2.join('');
			term_history.push(output);
			term_history_pos=0;
			s='';
			var a=output.split(' ');
			var p=a.shift();
			if(programs[p]!=undefined){s=programs[p](a);}else{s="\n"+p+" : command not found";}
			if(s){
				q1=[];
				q2=[];
				newline(s);
			}
			break;
	}
};

function autocomp(){if(!can_autocomp){return;}var o=q1.join('');var s=[];if(programs[o.split(' ')[0]]!=undefined){o=o.split(' ');if(o.length>1){o=o[o.length-1];}else{o="";}var l=files;}else{var l=programs;}var g=o.length;for(e in l){if(e.substring(0,g)==o){s.push(e);}}if(s.length==1){q1=q1.slice(0,q1.length-g);if(q1.length >1 && q1[q1.length-1]!=' '){q1.push(' ');}q1=q1.concat(s.pop().split(''));h();}else if(s.length>0){newline("\n"+s.join(' '));}}
kd=function(c){if(input_lock){return false;}var s="";switch(c.keyCode){case 8:if(c.altKey){while(q1.length>0){if(q1.pop()==' '){break;}}}else{q1.pop();}h();break;case 9:autocomp();break;case 13:enter();break;case 27:s="\x1b";break;case 37:if(q1.length>0){q2.unshift(q1.pop());}h();break;case 39:if(q2.length>0){q1.push(q2.shift());}h();break;case 38:if(c.ctrlKey){this.scroll_disp(-1);}else{if(term_history.length>0){term_history_pos++;if(term_history_pos>term_history.length){term_history_pos=term_history.length;}q1=term_history[term_history.length-term_history_pos].split('');q2=[];h();}}break;case 40:if(c.ctrlKey){this.scroll_disp(1);}else{if(term_history.length>0){term_history_pos--;if(term_history_pos<1){term_history_pos=0;q1=[];}else{q1=term_history[term_history.length-term_history_pos].split('');}q2=[];h();}}break;case 46:q2.shift();h();break;case 45:s="\x1b[2~";break;case 36:q2=q1.concat(q2);q1=[];h();break;case 35:q2=q1.concat(q2);q1=q2;q2=[];h();break;case 33:if(c.ctrlKey){this.scroll_disp(-(this.h-1));}else{s="\x1b[5~";}break;case 34:if(c.ctrlKey){this.scroll_disp(this.h-1);}else{s="\x1b[6~";}break;default:if(c.ctrlKey){if(c.keyCode==68){programs['exit']();}else if(c.keyCode>=65&&c.keyCode<=90){s=String.fromCharCode(c.keyCode-64);}else if(c.keyCode==32){s=String.fromCharCode(0);}}else if((!this.is_mac&&c.altKey)||(this.is_mac&&c.metaKey)){if(c.keyCode>=65&&c.keyCode<=90){s="\x1b"+String.fromCharCode(c.keyCode+32);}}break;}if(s){if(c.stopPropagation)c.stopPropagation();if(c.preventDefault)c.preventDefault();this.key_rep_state=1;this.key_rep_str=s;q1.push(s);h();return false;}else{this.key_rep_state=0;return true;}};
kp=function(c){if(input_lock){return false;}var s,t;if(c.stopPropagation)c.stopPropagation();if(c.preventDefault)c.preventDefault();s="";if(!("charCode"in c)){t=c.keyCode;if(this.key_rep_state==1){this.key_rep_state=2;return false;}else if(this.key_rep_state==2){q1.push(s);h();return false;}}else{t=c.charCode;}if(t!=0){if(!c.ctrlKey&&((!this.is_mac&&!c.altKey)||(this.is_mac&&!c.metaKey))){s=String.fromCharCode(t);}}if(s){q1.push(s);h();return false;}else{return true;}};

document.addEventListener("keydown",kd.bind(this),true);
document.addEventListener("keypress",kp.bind(this),true);

write("Hello, who are you ?\n", 'a', enter,50);
</script>
</body></html>
